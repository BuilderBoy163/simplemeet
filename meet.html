<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SimpleMeet++ — Serverless Signaling (Glassmorphism)</title>
  <style>
:root{
  --bg1:#071023;
  --bg2:#0b1a2b;
  --accent1:#7dd3fc;
  --accent2:#a78bfa;
  --muted:#98a8bf;
  --glass:rgba(255,255,255,0.06);
  --highlight:#7dd3fc;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto;color:#eaf2ff;background:linear-gradient(180deg,var(--bg1),var(--bg2));-webkit-font-smoothing:antialiased}
.app{max-width:1200px;margin:20px auto;padding:18px;display:flex;flex-direction:column;gap:16px}
header{display:flex;align-items:center;gap:14px;flex-wrap:wrap}
.brand{font-weight:800;font-size:20px;background:linear-gradient(90deg,var(--accent1),var(--accent2))text;color:transparent}
.glass{background:var(--glass);border:1px solid rgba(255,255,255,0.06);backdrop-filter: blur(8px);padding:10px;border-radius:12px;color:var(--muted);flex:1;min-width:120px}
.btn{padding:12px 16px;border-radius:12px;border:none;cursor:pointer;font-weight:700;font-size:16px}
.btn-main{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#042135}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
main{display:flex;gap:16px;flex-wrap:wrap}
.grid{flex:1;display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;padding:8px;overflow-x:auto}
.tile{position:relative;border-radius:14px;overflow:hidden;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2));border:1px solid rgba(255,255,255,0.04);box-shadow:0 8px 30px rgba(2,6,23,0.6);transition:all 0.3s ease;aspect-ratio:16/9}
.tile.speaking{border:3px solid var(--highlight);box-shadow:0 0 20px var(--highlight)}
.tile video{width:100%;height:100%;object-fit:cover;display:block}
.meta{position:absolute;left:8px;bottom:8px;padding:4px 8px;border-radius:999px;background:linear-gradient(90deg, rgba(0,0,0,0.5), rgba(0,0,0,0.25));font-weight:700;font-size:12px;display:flex;align-items:center;gap:4px}
.emoji-reactions{position:absolute;top:6px;right:6px;display:flex;gap:4px}
.emoji{cursor:pointer;font-size:18px}
.side{width:360px;display:flex;flex-direction:column;gap:12px;overflow-y:auto;max-height:calc(100vh - 100px)}
.panel{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.24));border:1px solid rgba(255,255,255,0.04);backdrop-filter:blur(10px)}
textarea{width:100%;height:92px;background:transparent;border:1px dashed rgba(255,255,255,0.04);color:inherit;padding:8px;border-radius:8px}
.chat-area{height:200px;overflow:auto;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px}
.chat-input{display:flex;gap:8px;margin-top:8px}
input[type=text]{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
button.small{padding:10px 12px;border-radius:10px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.02);font-size:14px}
.status{font-size:13px;color:var(--muted)}
/* MOBILE FRIENDLY */
@media(max-width:800px){
  header{flex-direction:column;align-items:flex-start}
  main{flex-direction:column}
  .side{width:100%;max-height:none;order:-1}
  .grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr))}
  .btn{width:100%}
  .chat-input{flex-direction:column}
  input[type=text]{width:100%}
}
main {
  display: flex;
  gap: 16px;
  overflow-y: auto;       /* allows scrolling only in main content */
  max-height: calc(100vh - 60px); /* leave room for header */
}

.side {
  width: 360px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  position: sticky;
  top: 60px; /* height of header */
  max-height: calc(100vh - 60px);
  overflow-y: auto;       /* side panel scrollable independently */
}

@media (max-width: 800px) {
  .side {
    position: fixed;      /* stay on top */
    top: 50px;            /* under header */
    right: 0;
    background: var(--bg2);
    z-index: 999;
    height: calc(100vh - 50px);
    box-shadow: -2px 0 8px rgba(0,0,0,0.5);
    transition: transform 0.25s ease-in-out;
    transform: translateX(100%); /* hidden by default */
  }
  .side.show {
    transform: translateX(0);
  }
  main {
    flex-direction: column;
    padding: 0 8px;
  }
  #toggleSide {
    display: inline-block;
  }
}

</style>

</head>
<body>
  <div class="app">
    <header>
      <div class="brand">SimpleMeet++</div>
      <div class="glass">
        <label style="font-size:12px;color:var(--muted)">Room (optional)</label>
        <input id="room" placeholder="room-1" value="room-1" />
      </div>
      <div style="margin-left:auto;display:flex;gap:8px">
        <button id="joinBtn" class="btn btn-main">Join</button>
        <button id="leaveBtn" class="btn btn-ghost" style="display:none">Leave</button>
      </div>
      <button id="toggleSide" class="btn btn-ghost" style="display:none">Toggle Panel</button>
    </header>

    <main>
      <div class="grid" id="grid"></div>

      <aside class="side">
        <div class="panel">
          <h4 style="margin:0 0 8px 0">Preview</h4>
          <div class="tile" style="min-height:120px"><video id="local" autoplay muted playsinline></video><div class="meta">You</div></div>
        </div>

        <div class="panel">
          <h4 style="margin:0 0 8px 0">Serverless Signaling</h4>
          <div style="font-size:13px;color:var(--muted);margin-bottom:8px">No central server — exchange the generated blobs using any chat app (Discord, SMS, DM). Works across networks with public STUN servers.</div>
          <button id="createOffer" class="small">Create Offer (copy & send)</button>
          <div style="margin-top:8px;"><label style="font-size:12px;color:var(--muted)">Paste remote blob here</label><textarea id="remoteBlob" placeholder="Paste remote offer/answer blob"></textarea><button id="acceptRemote" class="small">Accept Remote</button></div>
        </div>

        <div class="panel">
          <h4 style="margin:0 0 8px 0">Chat (peer-to-peer)</h4>
          <div class="chat-area" id="chatArea"></div>
          <div class="chat-input"><input id="chatInput" type="text" placeholder="Say something..." /><button id="sendChat" class="small">Send</button></div>
        </div>

        <div class="panel">
          <h4 style="margin:0 0 8px 0">Status</h4>
          <div id="status" class="status">Idle — serverless mode</div>
        </div>
      </aside>
    </main>
  </div>

<script>
const stunServers = [
  { urls: 'stun:stun.l.google.com:19302' },
  { urls: 'stun:stun1.l.google.com:19302' },
  { urls: 'stun:stun2.l.google.com:19302' }
];

const localV = document.getElementById('local');
const grid = document.getElementById('grid');
const statusEl = document.getElementById('status');
const createOfferBtn = document.getElementById('createOffer');
const remoteBlobTa = document.getElementById('remoteBlob');
const acceptRemoteBtn = document.getElementById('acceptRemote');
const chatArea = document.getElementById('chatArea');
const chatInput = document.getElementById('chatInput');
const sendChatBtn = document.getElementById('sendChat');

let localStream = null;
let pc = null;
let dc = null;
const peers = {};

function logStatus(msg){ statusEl.textContent = msg; }
function addChat(msg, from='me'){
  const d = document.createElement('div');
  d.textContent = (from ? from + ': ' : '') + msg;
  chatArea.appendChild(d);
  chatArea.scrollTop = chatArea.scrollHeight;
}

async function startLocal() {
  try {
    localStream = await navigator.mediaDevices.getUserMedia({ video:true, audio:true });
    localV.srcObject = localStream;
    logStatus('Local camera & mic ready');
    createOfferBtn.disabled = false;
  } catch(e) {
    alert('Cannot access camera/mic: ' + e.message);
  }
}
startLocal();

function makePC() {
  const _pc = new RTCPeerConnection({ iceServers: stunServers });
  if(localStream) localStream.getTracks().forEach(track => _pc.addTrack(track, localStream));

  _pc.ontrack = e => {
    const id = 'peer-' + Math.random().toString(36).slice(2,8);
    const tile = document.createElement('div');
    tile.className = 'tile';
    const v = document.createElement('video');
    v.autoplay = true;
    v.playsInline = true;
    v.srcObject = e.streams[0];
    const meta = document.createElement('div');
    meta.className = 'meta';
    meta.textContent = id;
    tile.appendChild(v);
    tile.appendChild(meta);
    grid.appendChild(tile);
    peers[id] = { video:v, el:tile };
  };

  _pc.oniceconnectionstatechange = () => logStatus('ICE: ' + _pc.iceConnectionState);
  return _pc;
}

function setupDataChannel(channel){
  dc = channel;
  dc.onopen = () => { logStatus('DataChannel open — chat available'); addChat('**connected**','system'); }
  dc.onmessage = ev => addChat(ev.data,'peer');
  dc.onclose = () => logStatus('DataChannel closed');
}

sendChatBtn.onclick = () => {
  const msg = chatInput.value.trim();
  if(!msg) return;
  if(dc && dc.readyState==='open'){ dc.send(msg); addChat(msg,'me'); chatInput.value=''; }
  else alert('Data channel not open yet');
}

function waitForIceGatheringComplete(pcInner){
  return new Promise(resolve=>{
    if(pcInner.iceGatheringState==='complete') return resolve();
    function check(){ if(pcInner.iceGatheringState==='complete'){ pcInner.removeEventListener('icegatheringstatechange',check); resolve(); } }
    pcInner.addEventListener('icegatheringstatechange',check);
    setTimeout(()=>{ try{ pcInner.removeEventListener('icegatheringstatechange',check) }catch{}; resolve(); },6000);
  });
}

createOfferBtn.onclick = async () => {
  if(!localStream){ alert('Local media not ready'); return; }
  pc = makePC();
  dc = pc.createDataChannel('chat'); setupDataChannel(dc);
  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  await waitForIceGatheringComplete(pc);
  remoteBlobTa.value = btoa(JSON.stringify({ type:'offer', sdp: pc.localDescription }));
  logStatus('Offer created — copy blob & send to peer');
}

acceptRemoteBtn.onclick = async () => {
  const txt = remoteBlobTa.value.trim(); if(!txt) return alert('Paste a blob first');
  let pkt = null; try{ pkt = JSON.parse(atob(txt)); } catch(e){ return alert('Invalid blob') }

  if(pkt.type==='offer'){
    pc = makePC();
    pc.ondatachannel = ev => setupDataChannel(ev.channel);
    await pc.setRemoteDescription(new RTCSessionDescription(pkt.sdp));
    const ans = await pc.createAnswer();
    await pc.setLocalDescription(ans);
    await waitForIceGatheringComplete(pc);
    remoteBlobTa.value = btoa(JSON.stringify({ type:'answer', sdp: pc.localDescription }));
    logStatus('Answer created — send back to offerer');
  } else if(pkt.type==='answer'){
    if(!pc) return alert('Create offer first');
    await pc.setRemoteDescription(new RTCSessionDescription(pkt.sdp));
    logStatus('Connected — video & chat should appear');
  } else alert('Unknown blob type');
}

remoteBlobTa.addEventListener('dblclick', ()=>{
  remoteBlobTa.select();
  document.execCommand('copy');
  alert('Copied to clipboard');
});

  const sidePanel = document.querySelector('.side');
const toggleBtn = document.getElementById('toggleSide');

// Show toggle button only on mobile
function checkMobile() {
  if(window.innerWidth <= 800){
    toggleBtn.style.display = 'inline-block';
    sidePanel.style.display = 'none';
    grid.style.gridTemplateColumns = 'repeat(auto-fill,minmax(200px,1fr))';
  } else {
    toggleBtn.style.display = 'none';
    sidePanel.style.display = 'flex';
    grid.style.gridTemplateColumns = 'repeat(auto-fill,minmax(260px,1fr))';
  }
}
  
window.addEventListener('resize', checkMobile);
checkMobile();
toggleBtn.onclick = () => {
  sidePanel.classList.toggle('show');
};


</script>
  

</body>
</html>
